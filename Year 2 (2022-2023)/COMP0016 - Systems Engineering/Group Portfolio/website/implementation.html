<!DOCTYPE html><!--  This site was created in Webflow. https://www.webflow.com  -->
<!--  Last Published: Fri Mar 31 2023 22:16:46 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="64248a3961395d0c34b90fdd" data-wf-site="638b9b74346ec7740c80f020">
<head>
  <meta charset="utf-8">
  <title>Implementation</title>
  <meta content="Touchless Kiosk Interface. Browser Plugin and App for Retailers, Hospitals and Museums..." name="description">
  <meta content="Implementation" property="og:title">
  <meta content="Touchless Kiosk Interface. Browser Plugin and App for Retailers, Hospitals and Museums..." property="og:description">
  <meta content="Implementation" property="twitter:title">
  <meta content="Touchless Kiosk Interface. Browser Plugin and App for Retailers, Hospitals and Museums..." property="twitter:description">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/touchless-kiosks.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inter:300,regular,500,600,700"]  }});</script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <style>
body{
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  }
</style>
</head>
<body>
  <div id="Top" class="back-to-top-container">
    <div class="back-to-top-button-wrapper">
      <a href="#Top" class="button-circle bg-gray-3 w-inline-block"><img src="images/icon-arrow-up.svg" alt="" class="button-circle-icon"></a>
    </div>
  </div>
  <div class="navbar-wrapper">
    <div class="container">
      <div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease" data-doc-height="1" role="banner" class="navbar w-nav">
        <div class="navbar-row">
          <div>
            <a href="index.html" class="navbar-1-brand w-nav-brand"><img src="images/filename-1.png" width="141" sizes="(max-width: 991px) 100vw, 141px" srcset="images/filename-1-p-500.png 500w, images/filename-1-p-800.png 800w, images/filename-1.png 972w" alt=""></a>
            <nav role="navigation" class="nav-menu w-nav-menu">
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link row w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="requirements.html">Requirements</a>
                      <link rel="prefetch" href="/requirements">
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="requirements.html#about-our-project" class="dropdown-item dropdown-item-large w-inline-block">Project Details</a>
                    <a href="requirements.html#requirement-gathering" class="dropdown-item dropdown-item-large w-inline-block">Requirement Gathering</a>
                    <a href="requirements.html#personas" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Personas</a>
                    <a href="requirements.html#moscow-reqs" class="dropdown-item dropdown-item-large w-inline-block">MoSCoW List</a>
                    <a href="requirements.html#use-cases" class="dropdown-item dropdown-item-large w-inline-block">Use Cases</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="research.html">Research</a>
                      <link rel="prefetch" href="/research">
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="research.html#related-project-review" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Related Project Review</a>
                    <a href="research.html#design-tech-review" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Design and Tech Review</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="ui-design.html">UI</a>
                      <link rel="prefetch" href="/ui-design">
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="ui-design.html#ui-design-overview" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Overview</a>
                    <a href="ui-design.html#kiosk-web-extension" class="dropdown-item dropdown-item-large w-dropdown-link">Web Extension</a>
                    <a href="ui-design.html#backend-launcher" class="dropdown-item dropdown-item-large w-dropdown-link">Backend Launcher (MFC)</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="system-design.html">System Design</a>
                      <link rel="prefetch" href="/system-design">
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="system-design.html#system-architecture" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">System Architecture</a>
                    <a href="system-design.html#motioninput-architecture" class="dropdown-item dropdown-item-large w-inline-block">MotionInput Architecture</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="implementation.html" aria-current="page" class="w--current">Implementation</a>
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="implementation.html#tools" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Tools &amp; Dependencies</a>
                    <a href="implementation.html#motioninput" class="dropdown-item dropdown-item-large w-inline-block">MotionInput</a>
                    <a href="implementation.html#web-extension" class="dropdown-item dropdown-item-large w-dropdown-link">Web Extension</a>
                    <a href="implementation.html#communication-protocol" class="dropdown-item dropdown-item-large w-dropdown-link">Communication Protocol</a>
                    <a href="implementation.html#intermediary-server" class="dropdown-item dropdown-item-large w-dropdown-link">Intermediary Server</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link row w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="testing.html">Testing</a>
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="testing.html#testing-overview" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Overview</a>
                    <a href="testing.html#unit-testing" class="dropdown-item dropdown-item-large w-inline-block">Unit Testing</a>
                    <a href="testing.html#integration-testing" class="dropdown-item dropdown-item-large w-dropdown-link">Integration Testing</a>
                    <a href="testing.html#user-acceptance-testing" class="dropdown-item dropdown-item-large w-dropdown-link">User Acceptance Testing</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="evaluation.html">Evaluation</a>
                      <link rel="prefetch" href="/evaluation">
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="evaluation.html#accomplishments" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Accomplishments</a>
                    <a href="evaluation.html#known-bugs" class="dropdown-item dropdown-item-large w-inline-block">Known Bugs</a>
                    <a href="evaluation.html#individual-contribution" class="dropdown-item dropdown-item-large w-inline-block">Individual Contribution</a>
                    <a href="evaluation.html#critical-evaluation" class="dropdown-item dropdown-item-large w-inline-block">Critical Evaluation</a>
                    <a href="evaluation.html#future-work" class="dropdown-item dropdown-item-large w-inline-block">Future Work</a>
                  </div>
                </nav>
              </div>
              <div data-delay="0" data-hover="true" class="w-dropdown">
                <div class="nav-link w-dropdown-toggle">
                  <div class="row row-align-center">
                    <div>
                      <a href="appendices.html">Appendices</a>
                    </div><img src="images/icon-caret-down.svg" alt="" class="dropdown-link-icon">
                  </div>
                </div>
                <nav class="dropdown-list w-dropdown-list">
                  <div class="dropdown-list-wrapper">
                    <div class="dropdown-bg"></div>
                    <a href="appendices.html#deployment-manual" data-scroll-time="5" class="dropdown-item dropdown-item-large w-inline-block">Deployment Manual</a>
                    <a href="appendices.html#user-manual" class="dropdown-item dropdown-item-large w-dropdown-link">User Manual</a>
                    <a href="appendices.html#development-blog" class="dropdown-item dropdown-item-large w-inline-block">Development Blog</a>
                    <a href="appendices.html#licenses" class="dropdown-item dropdown-item-large w-inline-block">Licenses</a>
                  </div>
                </nav>
              </div>
            </nav>
          </div>
          <div class="navbar-controls">
            <div class="menu-button w-nav-button"><img src="https://uploads-ssl.webflow.com/638b9c17ea2b8d06f75af7cc/638b9c17ea2b8d32ea5af819_icon-menu.svg" alt=""></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="section header wf-section">
    <div class="container justify-content-center">
      <div class="center-content content-width-large">
        <h5 class="panel-subheading text-primary-1">Implementation details of key features</h5>
        <h1 class="display-heading-2 no-bottom-space">Implementation</h1>
      </div>
    </div>
  </div>
  <section id="tools" class="section wf-section">
    <h1 class="display-heading-4 center-content">Tools &amp; Dependencies</h1>
    <div class="container">
      <div id="w-node-_1a4c77c0-77b6-7541-b696-e6aeb90f53f4-34b90fdd" class="container-2">
        <div class="w-layout-grid">
          <div data-w-id="1a4c77c0-77b6-7541-b696-e6aeb90f53f5" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">A. MediaPipe</h5>
              </div><img src="images/mediapipe-logo.png" loading="lazy" width="313" sizes="(max-width: 479px) 70vw, 313px" srcset="images/mediapipe-logo-p-500.png 500w, images/mediapipe-logo-p-800.png 800w, images/mediapipe-logo.png 882w" alt="" class="image-4">
              <div class="body-text-small body-text-medium"><span class="text-gray">MediaPipe is an open-source ML model</span> developed by Google. Our solution makes heavy use of the MediaPipe Hands module to track the landmark points and position of the hands, which we use for gesture calculations.<br></div>
            </div>
          </div>
          <div data-w-id="f992bf89-f80e-6d41-9af5-33243b74b689" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">B. Nuitka</h5>
              </div><img src="images/nuitka-logo.png" loading="lazy" width="300" sizes="(max-width: 479px) 70vw, 300px" srcset="images/nuitka-logo-p-500.png 500w, images/nuitka-logo.png 506w" alt="" class="image-tool-logo">
              <div class="body-text-small body-text-medium"><span class="text-gray">Nuitka is a highly efficient python compiler</span> that can bundle all the dependencies and libraries into one executable. We use this to enable MotionInput and the intermediary server to run on any Windows platform, even if Python is not installed.<br></div>
            </div>
          </div>
          <div data-w-id="03b09f20-3999-7e9e-d7e6-e5cbaa9dbbd1" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">C. ZeroMQ</h5>
              </div><img src="images/zeromq-logo.png" loading="lazy" width="300" sizes="(max-width: 479px) 70vw, 300px" srcset="images/zeromq-logo-p-500.png 500w, images/zeromq-logo.png 620w" alt="" class="image-tool-logo">
              <div class="body-text-small body-text-medium"><span class="text-gray">ZeroMQ (ØMQ) is a high-performance messaging library</span> that provides a socket-like interface for communication between applications. It supports various messaging patterns, is lightweight, easy to use, and can be used in multiple programming languages. We use it to enable communication between our intermediary server and MotionInput.<br></div>
            </div>
          </div>
          <div data-w-id="9f0492a3-5e9c-d9e2-28ac-d3750cc77c8a" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">D. Python WebSockets</h5>
              </div><img src="images/websockets-logo.png" loading="lazy" width="210" sizes="(max-width: 479px) 70vw, 210px" srcset="images/websockets-logo-p-500.png 500w, images/websockets-logo.png 526w" alt="" class="image-tool-logo">
              <div class="body-text-small body-text-medium"><span class="text-gray">The Python websockets library is a module for building WebSocket servers and clients in Python.</span> It provides a simple and easy-to-use interface for sending and receiving messages over a WebSocket connection. We use it to enable communication between our intermediary server and the WebExtension frontend, which can only use web-based technologies.<br></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section id="motioninput" class="section wf-section">
    <h1 class="display-heading-4 center-content">MotionInput</h1>
    <div class="container">
      <div class="w-layout-grid grid-11">
        <div id="w-node-e45ed758-5c5d-27d8-d0dd-232ed67afd4b-34b90fdd" class="container-2">
          <div data-w-id="e45ed758-5c5d-27d8-d0dd-232ed67afd4c" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">A. Hand Module and Key Components</h5>
              </div>
              <div class="body-text-small body-text-medium">In this section, we describe the functioning of MotionInput, specifically the hand module, to better understand and discuss the changes and added features that we implemented for our solution. The general architecture of the implemented HandModule class is as follows:<br></div>
              <div class="accordion-head">
                <h5 class="accordion-head-text-2 text-white">HandModule Architecture</h5>
                <div id="w-node-e45ed758-5c5d-27d8-d0dd-232ed67afd60-34b90fdd" class="icon-circle-small-2 bg-gray-3"><img src="https://uploads-ssl.webflow.com/638b9c17ea2b8d06f75af7cc/638b9c17ea2b8d707f5af8ab_icon-chevron-right-small-white.svg" alt="" class="icon-small"></div>
              </div>
              <div class="accordion-body">
                <div class="div-block-3 center-content"><img src="images/hand-module-design.png" loading="lazy" width="313" sizes="(max-width: 479px) 135px, (max-width: 767px) 41vw, 313px" srcset="images/hand-module-design-p-500.png 500w, images/hand-module-design-p-800.png 800w, images/hand-module-design.png 810w" alt="" class="image-5"></div>
              </div>
            </div>
          </div>
        </div>
        <div id="w-node-e45ed758-5c5d-27d8-d0dd-232ed67afd64-34b90fdd" class="container-2">
          <div data-w-id="e45ed758-5c5d-27d8-d0dd-232ed67afd65" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">B. HandLandmark Detector</h5>
              </div>
              <div class="body-text-small body-text-medium">The <span class="text-gray">HandLandmark class</span> uses the MediaPipe Hands module for <span class="text-gray">gathering raw data</span> from each video frame. It tracks the specified number of hands in the frame and <span class="text-gray">extracts biometric landmarks</span> such as the coordinates of the wrist, coordinates of the fingertips etc. It then <span class="text-gray">stores this gathered data</span> in an instance of the RawData class, which is later available to both the HandModule and the main MotionInput Model class, which is in charge of orchestrating core functions, such as managing and switching events, initializing classes, etc.<br></div>
            </div>
          </div>
        </div>
        <div id="w-node-_8133f992-f228-0a22-9dc8-3567565b3bdc-34b90fdd" class="container-2">
          <div data-w-id="8133f992-f228-0a22-9dc8-3567565b3bdd" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">C. HandPosition and HandGesture</h5>
              </div>
              <div class="body-text-small body-text-medium"><span class="text-gray">HandPosition is used for determining whether specified primitives occur or not.</span> For example, we define the primitive “index_pinched”, which uses the RawData coordinates to calculate whether this primitive holds true. The calculation in this case is based on the position of the index_tip, the wrist, the palm etc. These primitives make it easy for high-level gesture events to directly track low-level gestures rather than having to define and calculate them manually.<br><br>The <span class="text-gray">HandGesture class</span> is used for maintaining the state of all gestures related to the hand module.<br></div>
            </div>
          </div>
        </div>
        <div id="w-node-cc760e59-fba8-baef-3ea7-f5817b620015-34b90fdd" class="container-2">
          <div data-w-id="cc760e59-fba8-baef-3ea7-f5817b620016" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">D. Crowd Detection</h5>
                <div class="body-text-small body-text-medium"><span class="text-gray">Previously in MotionInput, the HandLandmarkDetector would send the RawData instance the coordinates of the most recent hand of each hand type detected.</span> For example, if there were two left hands and two right hands in the frame, the RawData instance would only store the most recent right hand and the most recent left hand. This caused major issues for our scenario since it meant that a person standing in front of a kiosk could essentially have their control stolen away by a person in the background if they showed the same hand. <br><br>Furthermore, as MediaPipe essentially detected hands at random, the most recent hand it detected would be arbitrary and not replicable upon testing. <span class="text-gray">To alleviate this issue, we developed the following heuristic function in the HandLandmarkDetector class:</span><br></div><img src="images/best-hand-code.png" loading="lazy" width="841" sizes="(max-width: 479px) 85vw, (max-width: 767px) 84vw, (max-width: 991px) 87vw, 841px" srcset="images/best-hand-code-p-500.png 500w, images/best-hand-code-p-800.png 800w, images/best-hand-code-p-1080.png 1080w, images/best-hand-code-p-1600.png 1600w, images/best-hand-code.png 1634w" alt="" class="image-6 center-content">
                <div class="body-text-small body-text-medium">It takes the area of the approximate bounding box of the palm, which gives an idea of how close the hand is to the frame, and scales it by the negative log of the distance from the hand to the centre of the camera frame, to prefer hands closer to the centre. Now, in the HandLandmarkDetector, whenever MediaPipe detects hands in frame, it is first passed to the heuristic function and ranked based on the highest score. The best-scored hands of each type are then passed to the RawData instance, which can then be accessed by other classes and modules.<br></div>
              </div>
            </div>
          </div>
        </div>
        <div id="w-node-_1dc8a983-9239-2db5-7fcd-a49f104f72bf-34b90fdd" class="container-2">
          <div data-w-id="1dc8a983-9239-2db5-7fcd-a49f104f72c0" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">E. Swipe Gesture</h5>
                <div class="body-text-small body-text-medium">The <span class="text-gray">next step was to implement the swipe gestures</span> needed to map hand swipe movements to keyboard arrow presses. In MotionInput, all such <span class="text-gray">gestures are defined by subclassing the GestureEvent class</span>. A specific GestureEvent subclass is registered when MotionInput starts, based on config files, and defines the main mode of control of MotionInput. For example, there are pre-existing subclasses such as NoseScrollEvent and EyeTrackingEvent, which are responsible for scrolling the mouse based on nose movement, or moving the cursor based on eye movement respectively.<br><br><span class="text-gray">After being registered, the update method of the specific subclass is called on each frame</span> to enact any actions caused by the gestures. To do this, on each frame, the HandLandmarkDetector, HandPosition, and HandGesture classes each perform their respective roles to track hands, calculate primitives and pass this information to the GestureEvent subclass. Based on this received hand data, the GestureEvent subclass can then implement logic to use the calculated primitives and coordinates to detect when a specific gesture occurs and to trigger an event such as a keyboard press.<br><br>In our case, <span class="text-gray">we created a KioskSwipeEvent subclass</span> that implements the swipe gesture we want. This is how it works:<br></div>
                <ul role="list" class="list-5">
                  <li class="list-item-2">Firstly, we define a threshold that is derived from the user-set sensitivity. It is a measure of how far the user needs to be from the centre of the frame to register a swipe.</li>
                  <li class="list-item-2">Whenever the update function is called, it calculates the vector between the middle of the frame and the coordinates of the palm.<br></li>
                  <li class="list-item-2">If the norm of this vector is lesser than the defined threshold, the hand is in the centre, otherwise it is outside the centre. <span class="text-gray"><br></span></li>
                  <li class="list-item-2">We also calculate the largest component of the vector to find the intended swipe direction. <span class="text-gray"><br></span></li>
                  <li class="list-item-2">Then, we simply check if the hand was previously in the centre and is now swiping towards a direction. If so, we map this to a keyboard arrow press.<span class="text-gray"><br></span></li>
                  <li class="list-item-2">We also check if the index finger is pinched, which acts as an analog for a fist gesture. If so, we trigger the “Enter” button on the keyboard.<br></li>
                </ul><img src="images/swipe-code.png" loading="lazy" width="777" sizes="(max-width: 479px) 85vw, (max-width: 767px) 84vw, (max-width: 991px) 86vw, 777px" srcset="images/swipe-code-p-500.png 500w, images/swipe-code-p-800.png 800w, images/swipe-code-p-1080.png 1080w, images/swipe-code-p-1600.png 1600w, images/swipe-code.png 1756w" alt="" class="image-6 center-content">
                <div class="body-text-small body-text-medium"><span class="text-gray">The result is an extremely natural swipe gesture</span> that is adaptable to the user’s needs. The user <span class="text-gray">can adjust the sensitivity</span> based on their preferences, and they simple have to swipe from the centre to one of the edges accordingly. Our gesture event is also extremely performant since it only <span class="text-gray">uses the highly optimized C-based NumPy library</span> for all the vector calculations. We also use some tricks such as roots of unity of a square to quickly map vectors to named directions, avoiding slow constructs such as Python for loops or nested if statements.<br></div>
              </div>
            </div>
          </div>
        </div>
        <div id="w-node-_0878c9a8-0d26-16fa-3bfa-9138dbd4bf0e-34b90fdd" class="container-2">
          <div data-w-id="0878c9a8-0d26-16fa-3bfa-9138dbd4bf0f" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">F. <strong>Communication with Intermediary Server</strong></h5>
                <div class="body-text-small body-text-medium">Now that we have a KioskGestureEvent that can track the coordinates of the hand at each frame, and detect swipe gestures, we need some way to indicate to the user where their hand is in the frame and how far they need to swipe based on the sensitivity. As mentioned previously, to maintain user privacy, maintain a browser sandbox, and neatly integrate into any pre-existing kiosk UI, <span class="text-gray">we rely on a WebExtension frontend, which is connected to MotionInput via an intermediary server.</span><br><br>To communicate with the server, we <span class="text-gray">implemented a client</span> that uses the ZeroMQ library. It connects to the same localhost port as the intermediary server and runs receiver and listener threads based on the <span class="text-gray">ZeroMQ PAIR architecture</span>. It maintains two performant queue structures to keep track of incoming and outgoing messages and prevent dropping. It also contains <span class="text-gray">logic for sending keepalive</span> messages to maintain connection, <span class="text-gray">resting when needed to lower CPU usage</span>, and <span class="text-gray">limiting throughput as needed to keep memory use low.</span> All this detail is abstracted away for other classes and modules, and <span class="text-gray">they can use the features of the communication protocol with the following user-facing APIs:</span><br><br>-&gt; The <span class="text-gray">send_to_website</span> method can be called by any class to <span class="text-gray">send JSON-encoded data to the WebExtension</span> frontend. It works by appending this data to the outgoing queue, which is monitored for activity by the sender thread, and relays this information to the intermediary server. <br><br>-&gt; The <span class="text-gray">receive_from_website</span> method <span class="text-gray">retrieves JSON-encoded data from the incoming queue</span>, which is continually fed data from the receiver thread.<br><br>These two methods allow easy bidirectional communication with the intermediary server, which in turn facilitates bidirectional communication with the WebExtension frontend.<br></div>
                <div class="w-layout-grid grid-12"><img src="images/comm-code-1.png" loading="lazy" width="427" sizes="(max-width: 479px) 85vw, (max-width: 767px) 77vw, 427px" srcset="images/comm-code-1-p-500.png 500w, images/comm-code-1-p-800.png 800w, images/comm-code-1-p-1080.png 1080w, images/comm-code-1.png 1496w" alt="" class="image-6"><img src="images/comm-code-2.png" loading="lazy" width="320" id="w-node-_4586be71-9c1c-109d-13b8-6511708c9724-34b90fdd" srcset="images/comm-code-2-p-500.png 500w, images/comm-code-2.png 782w" sizes="(max-width: 479px) 70vw, 320px" alt="" class="image-6"></div>
                <div class="body-text-small body-text-medium">An <span class="text-gray">example</span> of how these methods are used <span class="text-gray">can be seen in our KioskSwipeEvent</span>. In the update method that we outlined previously, we compose the following JSON message and use the send_to_website method to send it to the intermediary server, which sends it to the WebExtension frontend.<br></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section id="web-extension" class="section wf-section">
    <h1 class="display-heading-4 center-content">Web Extension</h1>
    <div id="w-node-_13b3bfd1-bdd7-43ed-d339-7ad544d8316a-34b90fdd" class="container">
      <div class="w-layout-grid grid-19">
        <div id="w-node-_13b3bfd1-bdd7-43ed-d339-7ad544d8316c-34b90fdd" class="container-2">
          <div data-w-id="13b3bfd1-bdd7-43ed-d339-7ad544d8316d" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">A. Web Extension</h5>
              </div>
              <div class="w-layout-grid grid-12"><img src="images/web-ext-1.png" loading="lazy" width="190" id="w-node-c0c1da34-bd2d-be37-666a-1c9a0da8f7b0-34b90fdd" srcset="images/web-ext-1-p-500.png 500w, images/web-ext-1.png 586w" sizes="(max-width: 479px) 70vw, 190px" alt="" class="image-8"><img src="images/web-ext-2.png" loading="lazy" width="191" id="w-node-c0c1da34-bd2d-be37-666a-1c9a0da8f7b1-34b90fdd" srcset="images/web-ext-2-p-500.png 500w, images/web-ext-2.png 580w" sizes="(max-width: 479px) 70vw, 191px" alt="" class="image-7"></div>
              <div class="body-text-small body-text-medium">Our WebExtension frontend is <span class="text-gray">written in React</span>, a popular JavaScript library for building user interfaces. It <span class="text-gray">communicates directly with the intermediary server</span> using a local WebSockets connection and can send and receive JSON-encoded data, using the react <span class="text-gray">useWebsocket React library</span>.<br><br>The library is used to attach several listeners to the WebSocket connection that are triggered whenever a new message is received. It uses several of React’s features, such as <span class="text-gray">useEffect hooks</span> to efficiently detect new messages and trigger the appropriate response, as well as reactive <span class="text-gray">useState hooks</span> to keep track of settings and other configuration options throughout the lifetime of the extension. It can also directly send data using browser-native WebSocket sending capabilities. The UI for the frontend is written in ChakraUI, a popular react UI framework, that provides extensible and responsive UI elements such as sliders, buttons, headings etc.<br><br><span class="text-gray">Our program is divided into three main components: <strong>PreviewWindow</strong>, <strong>SensitivitySlider</strong>, and <strong>StatusInfo</strong>. </span> <br></div>
            </div>
          </div>
        </div>
        <div id="w-node-_827c5866-a770-86b0-d83e-1529ca8501c7-34b90fdd" class="container-2">
          <div data-w-id="827c5866-a770-86b0-d83e-1529ca8501c8" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">B. PreviewWindow</h5>
              </div>
              <div class="body-text-small body-text-medium">The <strong class="text-gray">PreviewWindow</strong> component is <span class="text-gray">responsible for rendering a live preview of the user’s hand</span> as well as the detection boundaries. This data is sent by the MotionInput backend, following our JSON schema, and is then relayed to the frontend via the intermediary server. The frontend then renders an abstract preview of the user’s hand using the coordinates sent. For example, to draw the emoji preview, the following WebSocket event listener is called.</div><img src="images/preview-window-code-1.png" loading="lazy" width="488" sizes="(max-width: 479px) 85vw, (max-width: 767px) 80vw, 488px" srcset="images/preview-window-code-1-p-500.png 500w, images/preview-window-code-1-p-800.png 800w, images/preview-window-code-1-p-1080.png 1080w, images/preview-window-code-1.png 1160w" alt="" class="image-6">
              <div class="body-text-small body-text-medium">To render the live preview, the following <span class="text-gray">drawEmoji function</span> is called to position an image of an emoji in the specified preview element. The abstract emoji element is targeted using <span class="text-gray">React’s useRef hook</span>, reducing memory use, and is be positioned exactly using CSS absolute positioning and dynamically specifying offsets based on the received coordinates, as well as adjusting the image size to simulate depth changes. The use of native HTML DOM elements and directly altering properties via JavaScript make it extremely performant and reactive compared to third party animation libraries or even the native Canvas API.</div><img src="images/preview-window-code-2.png" loading="lazy" width="488" sizes="(max-width: 479px) 85vw, (max-width: 767px) 80vw, 488px" srcset="images/preview-window-code-2-p-500.png 500w, images/preview-window-code-2-p-800.png 800w, images/preview-window-code-2-p-1080.png 1080w, images/preview-window-code-2.png 1162w" alt="" class="image-6">
              <div class="body-text-small body-text-medium">Similar functions are used for displaying the threshold edges and animating edges based on the swipe direction.</div>
            </div>
          </div>
        </div>
        <div id="w-node-d72efac3-8436-27b3-aa76-e522e052a9c2-34b90fdd" class="container-2">
          <div data-w-id="d72efac3-8436-27b3-aa76-e522e052a9c3" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">C. SensitivitySldier</h5>
              </div>
              <div class="body-text-small body-text-medium">The <strong class="text-gray">SensitivitySlider</strong> component is <span class="text-gray">responsible for allowing the user to adjust the sensitivity of the camera/motion sensor</span>. This is done using a slider input element, which uses the <strong class="text-gray">sendSensitivityJson</strong> function as an event listener whenever the slider value changes. This function sends a JSON message to the intermediary server with the new sensitivity value, following our JSON schema, which then relays it to the MotionInput backend. The backend can then adjust the sensitivity used by the KioskSwipeEvent based on this value. The component also has a WebSocket event listener, that listens for sensitivity changes from the backend, for example, if the admin frontend changes the sensitivity, and updates the slider accordingly.</div><img src="images/sens-slider.png" loading="lazy" width="301" sizes="(max-width: 479px) 70vw, 301px" srcset="images/sens-slider-p-500.png 500w, images/sens-slider-p-800.png 800w, images/sens-slider.png 1068w" alt="" class="image-6">
            </div>
          </div>
        </div>
        <div id="w-node-ecfea147-09b6-5900-aac4-2fe1e01cb149-34b90fdd" class="container-2">
          <div data-w-id="ecfea147-09b6-5900-aac4-2fe1e01cb14a" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">D. StatusInfo</h5>
              </div>
              <div class="body-text-small body-text-medium">Finally, the <strong class="text-gray">StatusInfo</strong> component <span class="text-gray">displays information about the status of the WebSocket connection and MotionInput connection</span>. For the WebSocket connection status, this is done using the built-in <strong class="text-gray">readyState</strong> variable from the <strong class="text-gray">useWebSocket</strong> library, which changes whenever the state of the WebSocket connection changes. For the MotionInput conenction status, it monitors status message from the intermediary server using a WebSocket event listener and updates the status of the MotionInput connection accordingly.</div>
            </div>
          </div>
        </div>
        <div id="w-node-_672712e0-af60-06a2-0277-0c1e9d3d77dd-34b90fdd" class="container-2">
          <div data-w-id="672712e0-af60-06a2-0277-0c1e9d3d77de" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-3">E. Deploying the Extension</h5>
              </div>
              <div class="body-text-small body-text-medium">All these components are arranged into a vertical stack using <span class="text-gray">ChakraUI layout</span> components and are passed the same instance of the WebSocket connection using React’s context manager feature. This allows each component to be developed separately, maintaining separation of concerns, but be able to access the same application-wide WebSocket connection to send messages, receive messages and attach event listeners.<br><br>The overall component structure is then rendered onto a blank HTML page. <span class="text-gray">To turn this into a sidebar extension, we simply follow the manifest v3 specification by Mozilla, and create a manifest.json file</span> accordingly, specifying that we want the resulting HTML page to render in the sidebar. Due to the responsive design of the page, as well as the vertical layout, <span class="text-gray">the content looks great in a sidebar of any size.</span><br></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section id="communication-protocol" class="section wf-section">
    <h1 class="display-heading-4 center-content">Communication Protocol</h1>
    <div class="container">
      <div id="w-node-_1f3c3ee2-f165-4b01-6b3f-8852ed152aee-34b90fdd" class="container-2">
        <div data-w-id="1f3c3ee2-f165-4b01-6b3f-8852ed152aef" class="panel">
          <div class="panel-body">
            <div class="space-bottom-large">
              <h5 class="panel-subheading text-primary-3">Communication Protocol</h5>
            </div>
            <div class="body-text-small body-text-medium">Enabling <span class="text-gray">bidirectional communication between the WebExtension frontend and the MotionInput backend</span> is an essential feature of our solution. The <span class="text-gray">frontend needs to continually receive updates</span> from the backend about things such as the <span class="text-gray">hand positions, gesture sensitivity, direction moved, hand orientation etc.,</span> while the backend needs to be able to receive any config changes made from the WebExtension frontend.<br><br>Since web-based technologies are sandboxed and very restrictive in terms of access to the host operating system, we cannot make use of standard features such as lock files, process pipes, and other such synchronization primitives. To get around this, as mentioned in our system design page, we <span class="text-gray">developed a very lightweight intermediary server</span> that sits in-between the frontend and backend and communicates with platform-specific messaging protocols: <span class="text-gray">ZeroMQ for the backend, and WebSockets for the frontend</span>.<br><br><span class="text-gray">The core function of the intermediary server is to act as a relay server and pass messages along</span>. The senders on the frontend and backend can send JSON-encoded messages to the intermediary server, while the receivers on the frontend and backend can then do as they please with the data received. The JSON messages follow a stateless design, where messages are interpreted independently of each other. This allows for high message throughput without worrying about dropped messages. The <span class="text-gray">JSON schema</span> is also simple and <span class="text-gray">defines several message types </span>such as “<span class="text-gray">mi_status</span>”, “<span class="text-gray">mi_update</span>”, and “<span class="text-gray">mi_config</span>”. Upon receiving the JSON-encoded messages, the receivers on either the frontend or backend can unpack the data based on the type of message and perform any changes accordingly. <br><br><span class="text-gray">For example</span>, in the example below, when the WebExtension frontend receives a message with the type “mi_status”, it updates the connection status info element on the frontend.<br></div><img src="images/comm-protocol-code.png" loading="lazy" width="619" sizes="(max-width: 479px) 85vw, (max-width: 767px) 81vw, 619px" srcset="images/comm-protocol-code-p-500.png 500w, images/comm-protocol-code-p-800.png 800w, images/comm-protocol-code-p-1080.png 1080w, images/comm-protocol-code-p-1600.png 1600w, images/comm-protocol-code.png 1760w" alt="" class="image-6">
          </div>
        </div>
      </div>
    </div>
  </section>
  <section id="intermediary-server" class="section wf-section">
    <h1 class="display-heading-4 center-content">Intermediary Server</h1>
    <div id="w-node-_5fb872e8-bc95-e49f-47ad-44235c7b290e-34b90fdd" class="container">
      <div class="w-layout-grid grid-13">
        <div id="w-node-a8709484-fe7c-8cc8-06da-e675d27d68d4-34b90fdd" class="container-2">
          <div data-w-id="a8709484-fe7c-8cc8-06da-e675d27d68d5" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">Interfacing with ZeroMQ Sockets</h5>
              </div>
              <div class="body-text-small body-text-medium"><span class="text-gray">The intermediary server provides the following methods for interfacing with ZeroMQ sockets:</span><br>‍<br>-&gt; <strong class="text-gray">receive_from_zeromq():</strong> Continually listens for new messages from the MotionInput backend via the ZeroMQ socket and appends them to the<strong> mi_to_website_queue</strong> message queue.<br>‍<br>-&gt; <strong class="text-gray">send_to_zeromq():</strong> Continually tries to send messages from the <strong class="text-gray">website_to_mi_queue</strong> message queue to the MotionInput backend via the ZeroMQ socket.<br><br>Both of these functions use a <strong class="text-gray">rest()</strong> function to sleep briefly to <span class="text-gray">keep CPU usage low</span> when polling sockets. They also limit throughput as needed to lower memory use.<br></div>
            </div>
          </div>
        </div>
        <div id="w-node-e10b50a1-735a-ca9d-98f0-21290d89495d-34b90fdd" class="container-2">
          <div data-w-id="e10b50a1-735a-ca9d-98f0-21290d89495e" class="panel">
            <div class="panel-body">
              <div class="space-bottom-large">
                <h5 class="panel-subheading text-primary-2">Interfacing with Websockets</h5>
              </div>
              <div class="body-text-small body-text-medium"><strong></strong><span class="text-gray">The intermediary server also provides functions for interfacing with websockets: </span><br><br>-&gt; The <strong class="text-gray">websocket_handler()</strong> function is called for each new websocket connection and runs the <strong class="text-gray">send_to_websocket()</strong> and <strong class="text-gray">receive_from_websocket()</strong> functions concurrently<br><br>-&gt; The <strong class="text-gray">send_to_websocket()</strong> function is an asynchronous function that listens for new messages in the <strong class="text-gray">mi_to_website_queue </strong>message queue and sends them to the WebExtension frontend via a WebSocket connection. If there are no messages in the queue for more than 5 seconds, it sends a &quot;<span class="text-gray">keepalive</span>&quot; message to the frontend, to let it know that the intermediary server is alive, and to notify the frontend that MotionInput isn’t connected.<br><br>The <strong class="text-gray">receive_from_websocket()</strong> function is another asynchronous function that listens for new messages from the WebExtension frontend via a WebSocket and adds them to the <strong class="text-gray">website_to_mi_queue</strong> message queue. It can also receive commands from the WebExtension frontend to do things like relaunching MotionInput if it is not running.  <br></div>
            </div>
          </div>
        </div>
        <div id="w-node-_5fb872e8-bc95-e49f-47ad-44235c7b290f-34b90fdd" class="container-2">
          <div data-w-id="5fb872e8-bc95-e49f-47ad-44235c7b2910" class="panel">
            <div class="panel-body">
              <div class="body-text-small body-text-medium"><strong></strong>The <span class="text-gray">program creates two threads</span> to handle ZeroMQ communication, binding to a specified localhost port, and then starts the local websocket server. When the program is run, the <span class="text-gray">ZeroMQ communication threads</span> and the <span class="text-gray">serve_websocket()</span> function are run concurrently.<br><br><span class="text-gray">The end result is a lightweight, yet powerful relay server that facilitates bidirectional communication between MotionInput and the WebExtension frontend, using minimal overhead, and preserving the browser sandbox.   </span><br></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="footer wf-section">
    <div class="container">
      <div class="panel">
        <div class="panel-body footer-1-panel-body">
          <div class="footer-1-top-row">
            <div class="content-width-extra-small">
              <a href="index.html" class="space-bottom w-inline-block"><img src="images/filename-1.png" width="170" sizes="(max-width: 479px) 60vw, 170px" srcset="images/filename-1-p-500.png 500w, images/filename-1-p-800.png 800w, images/filename-1.png 972w" alt=""></a>
              <div class="text-lead">UCL MotionInput v3.2<br>Resilient Kiosk</div>
            </div>
          </div>
          <div class="footer-1-bottom-row">
            <div class="text-small">© Copyright Panels • Powered by <a href="https://www.webflow.com/" target="_blank">Webflow</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=638b9b74346ec7740c80f020" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>